<!DOCTYPE html>
<html lang="en">
  <head>
    {% include 'common_head.html' %}
  </head>
  <body>
    <div class="container">
      <div class="header">
          <nav>
              <ul class="nav nav-pills pull-right">
                <li role="presentation" ><a href="main">Home</a>
                </li>
                <li role="presentation"><a href="addJobs">Orders</a>
                </li>
                <li role="presentation"><a href="showSignUp">Add User</a>
                </li>
                <li role="presentation" class="active"><a href="#">SystemStats</a>
                </li>
                  {% include 'google_login.html' %}
              </ul>
          </nav>
          {% include 'common_title.html' %}
      </div>

      <div class="jumbotron">
        <h1>Some statistics</h1>
        <hr class="my-3">
        {% include 'game_desc.html' %}
      </div>

      <div class="well">
        <div class="row marketing">
              <h4 id='statistics'>Users and statistics: </h4>
              <p>
                <li>All statistics caluclated exluding user->user serving unless specified otherwise. </i>
              </p>
              <div class="table-responsive">
                  <table class="table table-striped">
                      <thead>
                          <tr>
                              <th scope="col">Id</th>
                              <th scope="col">Name</th>
                              <th scope="col">Email </th>
                              <th scope="col"><badge title="Value WITH THE badge modificators, raw is offered - consumed">Actual Score (raw)*</badge> </th>
                              <th scope="col"><badge title="Coffee offered withing # servings"> Offered** (#servings) </badge> </th>
                              <th scope="col"><badge title="Value WITHOUT SELF BUYINGS (and including SELFBUYINGS = times coffe was served)">Consumed*** (total) </badge> </th>
                          </tr>
                      </thead>
                      <tbody>
                      {% for user in users %}
                          <tr >
                              <th scope="row">{{ user[0] }}</th>
                              <td> {{ user[2] }}
                                {%for badge in assignedBadges %}
                                  {%if  badge[0] == user[0] %}
                                    <img src="{{ badge[5] }}" width="25" height="25" title="{{ badge[4] }}({{ badge[1] }}, effect: {{badge[7]}})"/>
                                  {% endif %}
                                {% endfor %}
                                </td>
                              <td> {{ user[1] }} </td>
                              <td> {{'%0.1f'| format(user[3]|float)}} ({{ usersStats.get(user[2], {False:0}).get('offered', 0) - usersStats.get(user[2], {False:0}).get('consumed', 0) }}) </td>
                              <td> {{ usersStats.get(user[2], {False:0}).get('offered', 0) }} ({{ usersStats.get(user[2], {False:0}).get('served', 0) }}) </td>
                              <td> {{ usersStats.get(user[2], {False:0}).get('consumed', 0) }} ({{ usersStats.get(user[2], {False:0}).get('consumed', 0) + usersStats.get(user[2], {False:0}).get('served', 0) }})</td>
                          </tr>
                      {% endfor %}
                      </tbody>
                  </table>
              </div>
        </div>
      </div>


            <div class="well">
               <div class="row marketing">
                     <h4> Badges Grant History </h4>
                     <div class="table-responsive">
                         <table class="table table-striped">
                             <thead>
                                 <tr>
                                     <th scope="col">Date</th>
                                     <th scope="col">Name</th>
                                     <th scope="col">Badge</th>
                                     <th scope="col">Badge name</th>
                                     {% if loggedUsernameEmail['email'] in adminsList['admin'].keys() or loggedUsernameEmail['email'] in adminsList['badgeadmin'].keys() %}
                                     <th scope="col">ACTION</th>
                                     {% endif%}
                                 </tr>
                             </thead>
                             <tbody>
                             {% for lastEntry in grantedBadges %}
                                 <tr >
                                     <th scope="row">{{ lastEntry[4] }}</th>
                                     <td> {{ lastEntry[1] }} </td>
                                     <td> <img src="{{ lastEntry[3] }}" width="25" height="25" /> </td>
                                     <td> {{ lastEntry[2] }} </td>
                                     {% if loggedUsernameEmail['email'] in adminsList['admin'].keys() or loggedUsernameEmail['email'] in adminsList['badgeadmin'].keys() %}
                                      <td>  <a href="removeBadge?grantId={{lastEntry[0]}}"> <img src="http://chittagongit.com/download/133528"  width="25" height="25" /> </a> </td>
                                     {% endif %}
                                 </tr>
                             {% endfor %}
                             </tbody>
                         </table>
                     </div>
                 </div>
             </div>


     <div class="well">
        <div class="row marketing">
              <h4 id='Achievements'> Badges and Achievements</h4>
              <div class="table-responsive">
                  <table class="table table-striped">
                      <thead>
                          <tr>
                              <th scope="col">Id</th>
                              <th scope="col">Badge</th>
                              <th scope="col">Name</th>
                              <th scope="col">Description</th>
                              <th scope="col">Effect</th>
                          </tr>
                      </thead>
                      <tbody>
                      {% for lastEntry in allBadges %}
                        {% if lastEntry[5] == 1 %}
                          <tr class="table-warning">
                        {% else %}
                          <tr >
                        {% endif %}
                              <th scope="row">{{ lastEntry[0] }}</th>
                              <td> <img src="{{ lastEntry[2] }}" width="50" height="50" /> </td>
                              <td> {{ lastEntry[1] }} </td>
                              <td> {{ lastEntry[3] }} </td>
                              <td> {{ lastEntry[4] }} </td>
                          </tr>
                      {% endfor %}
                      </tbody>
                  </table>
              </div>
          </div>
      </div>
      <div class="well">
         <div class="row marketing">
             <h4>Products: </h4>
             <div class="table-responsive">
                 <table class="table table-striped">
                     <thead>
                         <tr>
                             <th scope="col">Id</th>
                             <th scope="col">Name</th>
                             <th scope="col">Price </th>
                         </tr>
                     </thead>
                     <tbody>
                     {% for user in products %}
                         <tr >
                             <th scope="row">{{ user[0] }}</th>
                             <td> {{ user[1] }} </td>
                             <td> {{'%0.1f'| format(user[2]|float)}}</td>
                         </tr>
                     {% endfor %}
                     </tbody>
                 </table>
             </div>
           </div>
       </div>

      <footer class="footer">
      {% include 'footer.html' %}
      </footer>

    </div>
  </body>
</html>
